@model NAPASTUDENT.Models.ViewModels.QuanLyDonViViewModel

@{
    ViewBag.Title = Model.TenDonVi;
}    
@Html.AntiForgeryToken()
<link href="/Content/SiteCss/DonViStyles.css" rel="stylesheet">
<div class="HeaderContainer">
    <span class="Header">Đơn vị</span>
    <span class="HeaderText" style="color: lightgrey">|</span>
    <span class="HeaderText">Thông tin</span>
</div>
@if (!Model.ThanhVienChinhThuc && User.Identity.IsAuthenticated)
{
    <div style="text-align: center">
        <button class="btn btn-primary" id="DangKiThanhVienBtn">
            <i class="fas fa-file-signature"></i>
            <span id="DangKiThanhVienBtnText">Đăng kí thành viên</span>
            <span id="HuyDangKiThanhVienText">
                <i class="fas fa-user-times"></i>
                Hủy đăng kí
            </span>
        </button>
    </div>
}

<div class="body_80percent">
    <div class="anhBiaContainer">
        <img src="@Model.AnhBia" alt="Ảnh bìa lớp" class="anhBia">
        <div class="anhBiaTextBox">
            <div style="font-size: 3vw;font-weight: bold">@Model.TenDonVi</div>
        </div>
    </div>
    <div class="body_90percent gioiThieu">@Html.Raw(Model.GioiThieu)</div>
    <div class="nut-xemThem">
        <i class="fas fa-chevron-circle-down"></i> <span class="text-xemThem">Xem thêm</span>
    </div>
</div>
<div class="body_90percent">
    <nav style="margin-top: 25px">
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-danhSachSv-tab" data-toggle="tab" href="#nav-danhSachThanhVien" role="tab" aria-controls="nav-danhSachSv" aria-selected="false">Danh sách thành viên</a>
            <a class="nav-item nav-link" id="nav-chucVuDonVi-tab" data-toggle="tab" href="#nav-chucVuDonVi" role="tab" aria-controls="nav-chucVuDonVi" aria-selected="false">Danh sách chức vụ</a>
            <a class="nav-item nav-link" id="nav-cuuThanhVien-tab" data-toggle="tab" href="#nav-cuuThanhVien" role="tab" aria-controls="nav-cuuThanhVien" aria-selected="false">Danh sách cựu thành viên</a>
            <a class="nav-item nav-link" id="nav-hoatDongDonVi-tab" data-toggle="tab" href="#nav-hoatDongDonVi" role="tab" aria-controls="nav-hoatDongDonVi" aria-selected="false">Hoạt động đơn vị</a>
            <a class="nav-item nav-link" id="nav-baiVietDonVi-tab" data-toggle="tab" href="#nav-baiVietDonVi" role="tab" aria-controls="nav-baiVietDonVi" aria-selected="false">Bài viết đơn vị</a>
        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade active show" id="nav-danhSachThanhVien" role="tabpanel" aria-labelledby="nav-danhSachSv-tab">
            <div class="tabcontent">
                <table class="table table-striped table-bordered" id="danhSachThanhVienDonVi">
                    <thead>
                        <tr>
                            <th>Ảnh bìa</th>
                            <th>MSSV</th>
                            <th>Tên sinh viên</th>
                            <th>Ngày gia nhập</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-chucVuDonVi" role="tabpanel" aria-labelledby="nav-chucVuDonVi-tab">
            <div class="tabcontent align-vertically">
                <table class="table table-striped table-bordered" id="danhSachChucVuDonVi">
                    <thead>
                        <tr>
                            <th>Ảnh bìa</th>
                            <th>MSSV</th>
                            <th>Tên sinh viên</th>
                            <th>Chức vụ</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-cuuThanhVien" role="tabpanel" aria-labelledby="nav-cuuThanhVien-tab">
            <div class="tabcontent align-vertically">
                <table class="table table-striped table-bordered" id="danhSachCuuThanhVien">
                    <thead>
                        <tr>
                            <th>Ảnh bìa</th>
                            <th>MSSV</th>
                            <th>Tên sinh viên</th>
                            <th>Ngày gia nhập</th>
                            <th>Ngày rời đơn vị</th>
                            <th>Quá trình  công tác</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-hoatDongDonVi" role="tabpanel" aria-labelledby="nav-hoatDong-tab">
            <div class="tabcontent">
                <div class="tinMoiWrapper"></div>
                <div style="text-align: center; margin-top: 10px">
                    <a href="@Url.Action("HoatDongDonVi", "DonVi", Model.DonViId)" class="btn btn-success" style="font-size: 200%">
                        Xem tất cả hoạt động
                    </a>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-baiVietDonVi" role="tabpanel" aria-labelledby="nav-baiVietDonVi-tab">
            <div class="tabcontent">
                <div class="tinMoiWrapper"></div>
                <div style="text-align: center; margin-top: 10px">
                    <a href="@Url.Action("BaiVietDonVi", "BaiViet", Model.DonViId)" class="btn btn-success" style="font-size: 200%">
                        Xem tất cả bài viết
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="thongBaoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Thông báo</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="thongBaoModal-body">
                <div id="huyDangKiThanhVienThongBao">
                    <div>Bạn có chắc muốn hủy đăng kí thành viên đơn vị?</div>
                </div>
                <div id="dangKiThanhVienThongBao">
                    <div>Hãy giới thiệu bản thân, nêu lý do bạn muốn tham gia đơn vị:</div>
                    <form id="dangKiThanhVienForm">  
                        <div class="form-group">
                            <textarea rows="10" name="donDangKiThanhVien" id="donDangKiThanhVien" class="form-control"></textarea>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="dangKiThanhVien">Đăng kí</button>
                <button type="button" class="btn btn-danger" id="huyDangKiThanhVien">Hủy đăng kí</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

@section scripts
{   
    @Scripts.Render("~/bundles/DataTable")
    <script src="@Url.Content("~/Scripts/SiteScript/services/DonViService.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/SiteScript/controllers/DonViController.js")" type="text/javascript"></script>
    <script type="text/x-template" id="baiVietMoi_Template">
        <%
        _.each(danhSachBaiViet, function(baiViet){  %>
        <div class="tinMoi">
            <div class="imgWrapper">
                <a href="/BaiViet/<%= baiViet.id %>" title="<%= baiViet.tenBaiViet %>">
                    <img src="<%= baiViet.anhBia %>" alt="<%= baiViet.tenBaiViet %>">
                </a>
            </div>
            <div class="tinWrapper">
                <div class="title">
                    <a href="/BaiViet/<%= baiViet.id %>" title="<%= baiViet.tenBaiViet %>">
                        <%= baiViet.tenBaiViet %>
                    </a>
                </div>
                <p class="summary"><%= baiViet.soLuoc %></p>
                <div>
                    <span><i class="far fa-clock"></i> <%= moment(baiViet.ngayTao).format("HH:mm [ngày] DD/MM/YYYY") %></span>
                    <span>&ensp;-&ensp;</span>
                    <span><i class="far fa-eye"></i> <%= baiViet.soLuotXem %> lượt xem</span>
                </div>
            </div>
        </div>
        <%
        })
        %>
    </script>
    <script type="text/x-template" id="hoatDongMoi_Template">
        <%
        _.each(danhSachHoatDong, function(hoatDong){  %>
        <div class="tinMoi">
            <div class="imgWrapper">
                <a href="/HoatDong/ChiTiet/<%= hoatDong.id %>" title="<%= hoatDong.tenHoatDong %>">
                    <img src="<%= hoatDong.anhBia %>" alt="<%= hoatDong.tenHoatDong %>">
                </a>
            </div>
            <div class="tinWrapper">
                <div class="title">
                    <a href="/HoatDong/ChiTiet/<%= hoatDong.id %>" title="<%= hoatDong.tenHoatDong %>">
                        <%= hoatDong.tenHoatDong %>
                    </a>
                </div>
                <p class="summary"><%= hoatDong.soLuoc %></p>
                <div>
                    <span>
                        <i class="far fa-clock"></i>
                        <%= moment(hoatDong.ngayBatDau).format("HH:mm [ngày] DD/MM/YYYY") %>
                        &ensp;-&ensp;
                        <%= moment(hoatDong.ngayKetThuc).format("HH:mm [ngày] DD/MM/YYYY") %>
                    </span>
                    <br /> 
                    <span><i class="fas fa-school"></i> <%= hoatDong.diaDiem %></span> 
                    <span>&ensp;-&ensp;</span>
                    <span><i class="fas fa-users"></i> <%= hoatDong.soLuotThamGia %> lượt tham gia</span>
                </div>
            </div>
        </div>
        <%
        })
        %>
    </script>
    <script>
        $(document).ready(function () {
            var idDonVi = @Model.DonViId;
            var daDangKi=  @Model.DaDangKi.ToString().ToLower();
            QuanLyChungDonViController.initTrangThongTinDonVi(idDonVi,daDangKi);
        })
    </script>
}
