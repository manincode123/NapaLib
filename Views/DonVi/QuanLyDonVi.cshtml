@model NAPASTUDENT.Models.ViewModels.QuanLyDonViViewModel

@{
    ViewBag.Title = Model.TenDonVi;
}
@Html.AntiForgeryToken()
<link href="/Content/SiteCss/DonViStyles.css" rel="stylesheet">    
<link href="/Content/croppie/croppie.css" rel="stylesheet">

<div class="HeaderContainer">
    <span class="Header">Đơn vị</span>
    <span class="HeaderText" style="color: lightgrey">|</span>
    <span class="HeaderText" style="color:coral">Quản lý</span>
</div>
<div class="row" style="margin-bottom: 20px">
    @if (Model.QuanLyThongTin)
    {
        <div class="col-6 col-md-6 col-lg-6 align-vertically">
            <div class="btn btn-success quanLyDonViBtn" id="thayDoiThongTin">
                <i class="fas fa-edit"></i>
                Thay đổi thông tin
            </div>
        </div>
    }
    @if (Model.QuanLyChucVu)
    {
        <div class="col-6 col-md-6 col-lg-6 align-vertically">
            <a href="@Url.Action("QuanLyChucVu","DonVi",Model.DonViId)" class="btn btn-primary quanLyDonViBtn">
                <i class="fas fa-sitemap"></i>
                Quản lý chức vụ
            </a>
        </div>
    }
    @if (Model.QuanLyThanhVien)
    {
        <div class="col-6 col-md-6 col-lg-6 align-vertically">
            <a href="@Url.Action("QuanLyThanhVien","DonVi",Model.DonViId)" class="btn btn-info quanLyDonViBtn">
                <i class="fas fa-address-book"></i>
                Quản lý thành viên
            </a>
        </div>
    }
    @if (Model.QuanLyHoatDong)
    {
        <div class="col-6 col-md-6 col-lg-6 align-vertically">
            <a href="@Url.Action("HoatDongDonVi","DonVi",Model.DonViId)" class="btn btn-warning quanLyDonViBtn">
                <i class="fas fa-bullhorn"></i>
                Quản lý hoạt động
            </a>
        </div>
    }

</div>
<hr />
<div class="body_80percent">
    <div class="anhBiaContainer">
        <img src="@Model.AnhBia" alt="Ảnh bìa lớp" class="anhBia">
        <div class="anhBiaTextBox">
            <div style="font-size: 3vw;font-weight: bold">@Model.TenDonVi</div>
        </div>
    </div>
    <div class="body_90percent gioiThieu">@Html.Raw(Model.GioiThieu)</div>
    <div class="nut-xemThem">
        <i class="fas fa-chevron-circle-down"></i> <span class="text-xemThem">Xem thêm</span>
    </div>
</div>
<div class="body_90percent">
    <nav style="margin-top: 25px">
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <a class="nav-item nav-link active" id="nav-danhSachSv-tab" data-toggle="tab" href="#nav-danhSachThanhVien" role="tab" aria-controls="nav-danhSachSv" aria-selected="false">Danh sách thành viên</a>
            <a class="nav-item nav-link" id="nav-chucVuDonVi-tab" data-toggle="tab" href="#nav-chucVuDonVi" role="tab" aria-controls="nav-chucVuDonVi" aria-selected="false">Danh sách chức vụ</a>
            <a class="nav-item nav-link" id="nav-cuuThanhVien-tab" data-toggle="tab" href="#nav-cuuThanhVien" role="tab" aria-controls="nav-cuuThanhVien" aria-selected="false">Danh sách cựu thành viên</a>
            <a class="nav-item nav-link" id="nav-hoatDongDonVi-tab" data-toggle="tab" href="#nav-hoatDongDonVi" role="tab" aria-controls="nav-hoatDongDonVi" aria-selected="false">Hoạt động đơn vị</a>
            <a class="nav-item nav-link" id="nav-baiVietDonVi-tab" data-toggle="tab" href="#nav-baiVietDonVi" role="tab" aria-controls="nav-baiVietDonVi" aria-selected="false">Bài viết đơn vị</a>
        </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
        <div class="tab-pane fade active show" id="nav-danhSachThanhVien" role="tabpanel" aria-labelledby="nav-danhSachSv-tab">
            <div class="tabcontent">
                <table class="table table-striped table-bordered" id="danhSachThanhVienDonVi">
                    <thead>
                        <tr>
                            <th>Ảnh bìa</th>
                            <th>MSSV</th>
                            <th>Tên sinh viên</th>
                            <th>Ngày gia nhập</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-chucVuDonVi" role="tabpanel" aria-labelledby="nav-chucVuDonVi-tab">
            <div class="tabcontent align-vertically">
                <table class="table table-striped table-bordered" id="danhSachChucVuDonVi">
                    <thead>
                        <tr>
                            <th>Ảnh bìa</th>
                            <th>MSSV</th>
                            <th>Tên sinh viên</th>
                            <th>Chức vụ</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-cuuThanhVien" role="tabpanel" aria-labelledby="nav-cuuThanhVien-tab">
            <div class="tabcontent align-vertically">
                <table class="table table-striped table-bordered" id="danhSachCuuThanhVien">
                    <thead>
                        <tr>
                            <th>Ảnh bìa</th>
                            <th>MSSV</th>
                            <th>Tên sinh viên</th>
                            <th>Ngày gia nhập</th>
                            <th>Ngày rời đơn vị</th>
                            <th>Quá trình công tác</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-hoatDongDonVi" role="tabpanel" aria-labelledby="nav-hoatDong-tab">
            <div class="tabcontent">
                <div class="tinMoiWrapper"></div>
                <div style="text-align: center; margin-top: 10px">
                    <a href="@Url.Action("HoatDongDonVi", "DonVi", Model.DonViId)" class="btn btn-success" style="font-size: 200%">
                        Xem tất cả hoạt động
                    </a>
                </div>
            </div>
        </div>
        <div class="tab-pane fade" id="nav-baiVietDonVi" role="tabpanel" aria-labelledby="nav-baiVietDonVi-tab">
            <div class="tabcontent">
                <div class="tinMoiWrapper"></div>
                <div style="text-align: center; margin-top: 10px">
                    <a href="@Url.Action("BaiVietDonVi", "BaiViet", Model.DonViId)" class="btn btn-success" style="font-size: 200%">
                        Xem tất cả bài viết
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="SaveDonViModal" tabindex="-1" role="dialog" aria-labelledby="SaveDonViModal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered  modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="SaveDonViModal-title" style="font-weight: bold">Chỉnh sửa thông tin đơn vị</h2>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="SaveDonViModal-body">  
                <form id="donViForm">
                    <div hidden>
                        <input type="text" value="0" id="donViId" />
                    </div>
                    <div class="form-group">
                        <label for="tenDonVi" style="font-size: 30px;">Tên đơn vị</label>
                        <input value="" name="tenDonVi" id="tenDonVi" type="text" class="form-control input-25px input-80width" maxlength="100"/>
                        <small id="tenDonViLimit"></small>
                    </div>
                    <hr />
                    <div class="form-group">
                        <label for="ngayThanhLap" style="font-size: 30px">Ngày thành lập</label>
                        <input type="date" name="ngayThanhLap" id="ngayThanhLap" class="form-control input-25px" style="max-width: 35%">
                    </div>
                    <hr />
                    <div class="form-group">
                        <label for="loaiDonVi" style="font-size: 30px;">Đơn vị trực thuộc</label>
                        <select data-placeholder="Chọn đơn vị trực thuộc" name="loaiDonVi" id="loaiDonVi" class="form-control input-25px" style="max-width: 35%">
                            <option value="1">Đoàn Phân viện</option>
                            <option value="2">Hội Sinh viên Phân viện</option>
                        </select>
                    </div>
                    <hr />
                    <div class="form-group">
                        <label for="gioiThieu" style="font-size: 30px;">Giới thiệu</label>
                        <textarea value="" name="gioiThieu" id="gioiThieu" type="text" class="form-control" style="max-width: 80%; height: 100px"></textarea>
                    </div>
                    <hr />
                    <div class="form-group">
                        <label for="anhBiaDonVi_input" style="font-size: 30px; font-weight: bold">Ảnh bìa</label>
                        <input id="anhBiaDonVi_input" type="file" />
                        <img id="anhBiaDonVi" src="/Content/AnhBiaDonVi/AnhBiaHocVien.png" />
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#cropImagePop" id="editAnhBiaBtn">
                            Chỉnh sửa ảnh
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-success" id="saveDonVi">Lưu</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="cropImagePop" tabindex="1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="myModalLabel"><strong>Chỉnh sửa ảnh</strong></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="anhBiaDonVi-Wrapper"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                <button type="button" id="cropImageBtn" class="btn btn-primary">Up ảnh bìa</button>
            </div>
        </div>
    </div>
</div>

@section scripts
{  
    @Scripts.Render("~/bundles/DataTable")
    <script src="@Url.Content("~/ckeditor/ckeditor.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/ckfinder/ckfinder.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/croppie/croppie.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/SiteScript/services/DonViService.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/SiteScript/controllers/DonViController.js")" type="text/javascript"></script>
    <script type="text/x-template" id="baiVietMoi_Template">
    <%
    _.each(danhSachBaiViet, function(baiViet){  %>
    <div class="tinMoi">
        <div class="imgWrapper">
            <a href="/BaiViet/<%= baiViet.id %>" title="<%= baiViet.tenBaiViet %>">
                <img src="<%= baiViet.anhBia %>" alt="<%= baiViet.tenBaiViet %>">
            </a>
        </div>
        <div class="tinWrapper">
            <div class="title">
                <a href="/BaiViet/<%= baiViet.id %>" title="<%= baiViet.tenBaiViet %>">
                    <%= baiViet.tenBaiViet %>
                </a>
            </div>
            <p class="summary"><%= baiViet.soLuoc %></p>
            <div>
                <span><i class="far fa-clock"></i> <%= moment(baiViet.ngayTao).format("HH:mm [ngày] DD/MM/YYYY") %></span>
                <span>&ensp;-&ensp;</span>
                <span><i class="far fa-eye"></i> <%= baiViet.soLuotXem %> lượt xem</span>
            </div>
        </div>
    </div>
    <%
    })
    %>
    </script>
    <script type="text/x-template" id="hoatDongMoi_Template">
        <%
        _.each(danhSachHoatDong, function(hoatDong){  %>
        <div class="tinMoi">
            <div class="imgWrapper">
                <a href="/HoatDong/ChiTiet/<%= hoatDong.id %>" title="<%= hoatDong.tenHoatDong %>">
                    <img src="<%= hoatDong.anhBia %>" alt="<%= hoatDong.tenHoatDong %>">
                </a>
            </div>
            <div class="tinWrapper">
                <div class="title">
                    <a href="/HoatDong/ChiTiet/<%= hoatDong.id %>" title="<%= hoatDong.tenHoatDong %>">
                        <%= hoatDong.tenHoatDong %>
                    </a>
                </div>
                <p class="summary"><%= hoatDong.soLuoc %></p>
                <div>
                    <span>
                        <i class="far fa-clock"></i>
                        <%= moment(hoatDong.ngayBatDau).format("HH:mm [ngày] DD/MM/YYYY") %>
                        &ensp;-&ensp;
                        <%= moment(hoatDong.ngayKetThuc).format("HH:mm [ngày] DD/MM/YYYY") %>
                    </span>
                    <br />
                    <span><i class="fas fa-school"></i> <%= hoatDong.diaDiem %></span>
                    <span>&ensp;-&ensp;</span>
                    <span><i class="fas fa-users"></i> <%= hoatDong.soLuotThamGia %> lượt tham gia</span>
                </div>
            </div>
        </div>
        <%
        })
        %>
    </script>
    <script>
        $(document).ready(function () {
            var idDonVi = @Model.DonViId;
            var quanLyThongTin = @Model.QuanLyThongTin.ToString().ToLower();
            QuanLyChungDonViController.initTrangThongTinDonVi_QuanLy(idDonVi,quanLyThongTin);
        })
    </script>
}


